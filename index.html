<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title-Kalkulator Alokasi Investasi Profesional</title>
    <!-- Font & Icon -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root{
            --primary:#4f46e5;
            --primary-dark:#3730a3;
            --secondary:#10b981;
            --bg:#f3f4f6;
            --card:#ffffff;
            --text:#111827;
            --muted:#6b7280;
            --border:#e5e7eb;
            --radius:12px;
            --shadow:0 10px 15px -3px rgba(0,0,0,.08),0 4px 6px -2px rgba(0,0,0,.04);
        }
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;color:var(--text)}
        body{background:var(--bg);line-height:1.6;-webkit-font-smoothing:antialiased}
        .container{max-width:960px;margin:3rem auto;padding:0 1rem}
        header{text-align:center;margin-bottom:2.5rem}
        header h1{font-size:2rem;font-weight:700}
        header p{color:var(--muted);margin-top:.25rem}
        .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:1.75rem;margin-bottom:1.5rem}
        h2{font-size:1.25rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem}
        .form-group{display:flex;flex-direction:column}
        label{font-size:.875rem;font-weight:600;margin-bottom:.25rem}
        input,select{padding:.65rem .75rem;border:1px solid var(--border);border-radius:8px;font-size:.95rem;transition:border .2s}
        input:focus,select:focus{outline:none;border-color:var(--primary)}
        .question{margin-bottom:1.25rem}
        .question h3{font-size:1rem;font-weight:600;margin-bottom:.75rem}
        .options{display:grid;gap:.5rem}
        .option{padding:.75rem;border:2px solid var(--border);border-radius:8px;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:.5rem}
        .option:hover{border-color:var(--primary);background:#eef2ff}
        .option input{margin:0}
        .btn{width:100%;margin-top:1.5rem;padding:.85rem;font-size:1rem;font-weight:600;color:#fff;background:var(--primary);border:none;border-radius:8px;cursor:pointer;transition:background .2s}
        .btn:hover{background:var(--primary-dark)}
        .result{display:none;margin-top:2rem}
        .risk-badge{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:9999px;font-weight:600;font-size:1rem;margin-bottom:1rem}
        .risk-conservative{background:#d1fae5;color:#065f46}
        .risk-moderate{background:#fef3c7;color:#92400e}
        .risk-aggressive{background:#fee2e2;color:#991b1b}
        .alloc-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}
        .alloc-card{background:#f9fafb;border:1px solid var(--border);border-radius:8px;padding:1rem;text-align:center}
        .alloc-card .icon{font-size:2rem;margin-bottom:.5rem}
        .alloc-card .pct{font-size:1.5rem;font-weight:700}
        .alloc-card .name{font-size:.875rem;color:var(--muted)}
        .progress{height:6px;background:var(--border);border-radius:3px;margin:.5rem 0;overflow:hidden}
        .progress-bar{height:100%;background:var(--primary);transition:width 1s ease}
        .rec{background:#f3f4f6;border-radius:8px;padding:1rem;font-size:.95rem}
        .rec ul{list-style:none;padding-left:1.2rem}
        .rec li{position:relative;margin-bottom:.25rem}
        .rec li::before{content:'✓';position:absolute;left:-1.2rem;color:var(--secondary);font-weight:700}
        .toast{position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%) translateY(150%);background:#1f2937;color:#fff;padding:.75rem 1.25rem;border-radius:8px;font-size:.875rem;transition:transform .3s}
        .toast.show{transform:translateX(-50%) translateY(0)}
        .spinner{display:none;border:3px solid #f3f3f3;border-top:3px solid var(--primary);border-radius:50%;width:24px;height:24px;animation:spin 1s linear infinite;margin:0 auto .5rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        @media(max-width:600px){header h1{font-size:1.5rem}.btn{padding:.75rem}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎯 Kalkulator Alokasi Investasi</h1>
            <p>Dapatkan strategi investasi yang tepat sesuai profil risiko & kondisi keuangan Anda</p>
        </header>

        <!-- Informasi Dasar -->
        <section class="card">
            <h2><i class="fa fa-user"></i> Informasi Dasar</h2>
            <div class="form-grid">
                <div class="form-group"><label>Nama Lengkap</label><input id="fullName" placeholder="Contoh: Andi Wijaya"></div>
                <div class="form-group"><label>Usia</label><input id="age" type="number" placeholder="25"></div>
                <div class="form-group"><label>Pekerjaan</label><input id="job" placeholder="Contoh: Software Engineer"></div>
                <div class="form-group"><label>Pendapatan Bulanan (Rp)</label><input id="income" placeholder="8.000.000"></div>
                <div class="form-group"><label>Pengeluaran Bulanan (Rp)</label><input id="expense" placeholder="5.000.000"></div>
                <div class="form-group"><label>Dana Darurat Saat Ini (Rp)</label><input id="emergencyNow" placeholder="10.000.000"></div>
                <div class="form-group"><label>Jumlah Investasi Saat Ini (Rp)</label><input id="investAmount" placeholder="20.000.000"></div>
                <div class="form-group"><label>Jangka Waktu Investasi</label>
                    <select id="horizon">
                        <option value="">-- Pilih --</option>
                        <option value="1">&lt; 1 tahun</option>
                        <option value="2">1-3 tahun</option>
                        <option value="3">3-5 tahun</option>
                        <option value="4">5-10 tahun</option>
                        <option value="5">&gt; 10 tahun</option>
                    </select>
                </div>
                <div class="form-group" style="grid-column:1/-1"><label>Tujuan Investasi</label><input id="goal" placeholder="Contoh: Dana pensiun, biaya anak sekolah, beli rumah"></div>
            </div>
        </section>

        <!-- Pertanyaan Risiko -->
        <section class="card">
            <h2><i class="fa fa-brain"></i> Profil Risiko <small>(8 pertanyaan)</small></h2>
            <div id="qContainer"></div>
        </section>

        <button class="btn" onclick="handleAnalyze()">
            <div id="spin" class="spinner"></div>
            <span id="btnTxt">Analisis & Unduh PDF</span>
        </button>

        <!-- Hasil -->
        <div id="result" class="result card"></div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <script>
        /* ---------- DATA ---------- */
        const questions=[
            {q:"1. Reaksi Anda jika portofolio turun 20% dalam sebulan?",opt:["Segera jual semua","Tunggu beberapa bulan","Tambah investasi"]},
            {q:"2. Kerugian maksimal yang Anda nyamankan?",opt:["&lt; 5%","10-15%","20%+"]},
            {q:"3. Pengalaman investasi Anda?",opt:["Pemula","1-5 tahun","&gt; 5 tahun"]},
            {q:"4. Tujuan utama investasi?",opt:["Lindungi dari inflasi","Pertumbuhan moderat","Maksimalkan return"]},
            {q:"5. Berapa % pendapatan bisa dialokasikan?",opt:["&lt; 10%","10-25%","&gt; 25%"]},
            {q:"6. Ketersediaan dana darurat saat ini?",opt:["&lt; 1× pengeluaran","1-3×","&gt; 6×"]},
            {q:"7. Jangka waktu utama investasi?",opt:["&lt; 3 th","3-7 th","&gt; 7 th"]},
            {q:"8. Pilihan instrumen ideal?",opt:["Deposito & obligasi","Campuran","Saham & crypto"]}
        ];
        const profiles={
            conservative:{name:"Konservatif",badge:"risk-conservative",icon:"🛡️",color:"#10b981",alloc:{cash:10,emergency:15,bonds:45,deposit:20,stock:10},ret:"6-8%",risk:"Rendah",rec:["Sisihkan 10% kas harian","Pastikan 15% menutup 3× pengeluaran","Fokus obligasi & deposito","Pilih saham blue-chip"]},
            moderate:{name:"Moderat",badge:"risk-moderate",icon:"⚖️",color:"#f59e0b",alloc:{cash:5,emergency:10,stock:40,bonds:30,gold:10,mix:5},ret:"8-12%",risk:"Menengah",rec:["Kas 5% & darurat 10%","Kombinasi saham value-growth","Rebalancing 6 bulanan","Tambah emas"]},
            aggressive:{name:"Agresif",badge:"risk-aggressive",icon:"🚀",color:"#ef4444",alloc:{cash:3,emergency:7,stock:55,mutual:20,crypto:10,bonds:5},ret:"12-20%",risk:"Tinggi",rec:["Min 7% darurat","Fokus saham growth","Cost-averaging","Alokasi crypto ≤10%"]}
        };

        /* ---------- RENDER Q ---------- */
        const qc=document.getElementById('qContainer');
        questions.forEach((v,i)=>{
            const d=document.createElement('div');d.className='question';
            d.innerHTML=`<h3>${v.q}</h3><div class="options">${v.opt.map((o,ix)=>`
                <div class="option" onclick="selectOpt(${i},${ix})">
                    <input type="radio" name="q${i}" value="${ix+1}" id="q${i}_${ix}">
                    <label for="q${i}_${ix}">${o}</label>
                </div>`).join('')}</div>`;
            qc.appendChild(d);
        });
        function selectOpt(i,ix){document.querySelector(`#q${i}_${ix}`).checked=true;}

        /* ---------- ANALYZE ---------- */
        async function handleAnalyze(){
            const els=['fullName','age','job','income','expense','emergencyNow','investAmount','horizon','goal'].map(id=>document.getElementById(id));
            const [name,age,job,income,expense,emNow,amt,hor,goal]=els.map(e=>e.value.trim());
            if(els.some(v=>!v.value)){toast('Lengkapi semua kolah!');return;}
            const amount=toNum(amt),inc=toNum(income),exp=toNum(expense),emNowNum=toNum(emNow);
            if(amount<1e6){toast('Minimal investasi Rp 1 juta');return;}
            let score=0;
            for(let i=0;i<8;i++){
                const a=document.querySelector(`input[name="q${i}"]:checked`);
                if(!a){toast(`Jawab pertanyaan ${i+1}`);return;}
                score+=parseInt(a.value);
            }
            score+=parseInt(hor)*.5;
            let prof=score<=12?profiles.conservative:score<=20?profiles.moderate:profiles.aggressive;
            showResult(prof,name,age,job,amount,inc,exp,emNowNum,goal);
        }
        function showResult(prof,n,a,j,amt,inc,exp,emNow,goal){
            const needEm=exp*6;
            let html=`
                <div class="risk-badge ${prof.badge}">${prof.icon} ${prof.name}</div>
                <p><strong>${n}</strong> · ${a} th · ${j}</p>
                <p>Tujuan: ${goal}</p>
                <p>Expected Return: <b>${prof.ret}/th</b> · Risk: <b>${prof.risk}</b></p>
                <div class="alloc-grid">
            `;
            for(const[k,v]of Object.entries(prof.alloc)){
                const alloc=(amt*v)/100;
                html+=`
                    <div class="alloc-card">
                        <div class="icon">${k==='cash'?'💵':k==='emergency'?'🚑':k==='stock'||k==='mutual'?'📈':k==='bonds'?'🏦':k==='gold'?'🥇':k==='crypto'?'₿':'📦'}</div>
                        <div class="pct">${v}%</div>
                        <div class="name">${k==='cash'?'Uang Tunai':k==='emergency'?'Dana Darurat':k==='stock'?'Saham':k==='mutual'?'Reksa Dana':k==='bonds'?'Obligasi':k==='gold'?'Emas':k==='crypto'?'Crypto':'Deposito'}</div>
                        <div class="progress"><div class="progress-bar" style="width:${v}%"></div></div>
                        <div style="margin-top:.25rem;font-weight:600">${idr(alloc)}</div>
                    </div>`;
            }
            html+=`</div>`;
            if(emNow<needEm)html+=`<div class="rec" style="border-left:4px solid #ef4444"><b>Saran:</b> Tambah dana darurat ideal <b>${idr(needEm)}</b> (6× pengeluaran). Sa ini Anda ${idr(emNow)}.</div>`;
            html+=`<div class="rec"><ul>${prof.rec.map(r=>`<li>${r}</li>`).join('')}</ul></div>`;
            html+=`<button class="btn" onclick="downloadPDF()"><i class="fa fa-download"></i> Unduh PDF</button>`;
            document.getElementById('result').innerHTML=html;
            document.getElementById('result').scrollIntoView({behavior:'smooth'});
        }

        /* ---------- PDF ---------- */
        async function downloadPDF(){
            const {jsPDF}=window.jspdf;
            const pdf=new jsPDF('l','mm','a4');
            const res=document.getElementById('result');
            const canvas=await html2canvas(res,{scale:1.8,useCORS:true});
            const imgData=canvas.toDataURL('image/png');
            const w=270,h=(canvas.height*w)/canvas.width;
            pdf.addImage(imgData,'PNG',10,10,w,h);
            pdf.save(`Alokasi-Investasi-${document.getElementById('fullName').value||'Investor'}.pdf`);
        }

        /* ---------- UTILS ---------- */
        function toNum(str){return parseInt(str.replace(/\D/g,''))||0;}
        function idr(n){return new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(n);}
        function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500);}
    </script>
</body>
</html>
